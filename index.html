<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cricket Quiz Bet</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <style>
    :root {
      --primary: #27b0f7;
      --primary-dark: #1651d8;
      --accent: #00c6ad;
      --bg: #f6fbff;
      --surface: #fff;
      --card-radius: 20px;
      --shadow: 0 10px 34px -8px #1895a622;
      --gradient: linear-gradient(93deg,#1bace7 52%, #12dca1 110%);
    }
    body {background: var(--bg);font-family: 'Inter', Arial, sans-serif;margin: 0;}
    #newsBar{background:#ffe658;color:#1a2471;font-weight:600;font-size:1em;padding:7px 0;text-align:center;}
    #newsBar marquee{width:96%;display:inline-block;}
    #app-container {
      max-width:490px;margin:0 auto;min-height:100vh;
      background: var(--surface); border-radius:0 0 var(--card-radius) var(--card-radius);
      box-shadow:0 10px 34px -8px #1895a622;
      overflow-x:hidden;
    }
    #topbar {
      display:flex;align-items:center;justify-content:space-between;
      height:62px; background: var(--gradient); color: #fff; font-weight:700;
      padding:0 20px; position:sticky; top:0; z-index:100;
    }
    #logo { font-size:1.1em; }
    #topbar .right { display:flex; gap:10px; }
    #profileBtn, #signOutBtn {
      background:rgba(255,255,255,0.25); border:none; color:#fff;
      padding:6px 12px; border-radius:20px; cursor:pointer; font-size:0.85em;
      transition:all 0.2s; font-weight:600;
    }
    #profileBtn:hover, #signOutBtn:hover {
      background:rgba(255,255,255,0.4); transform:scale(1.05);
    }
    
    .modal {
      position:fixed; top:0; left:0; width:100vw; height:100vh;
      background:rgba(0,0,0,0.6); display:none; align-items:center;
      justify-content:center; z-index:1000; backdrop-filter:blur(5px);
    }
    .modal-content {
      background:#fff; width:90%; max-width:400px; border-radius:var(--card-radius);
      padding:24px; position:relative; max-height:85vh; overflow-y:auto;
      box-shadow:0 20px 60px rgba(0,0,0,0.3);
    }
    .close-btn {
      position:absolute; top:15px; right:15px; background:none;
      border:none; font-size:24px; cursor:pointer; color:#999;
      transition:color 0.2s;
    }
    .close-btn:hover { color:#000; }
    
    .stats-grid {
      display:flex; justify-content:space-between; padding:20px;
      background:rgba(255,255,255,0.9); margin:10px; border-radius:15px;
    }
    .stat-item { text-align:center; }
    .stat-value { font-size:1.4em; font-weight:700; color:var(--primary); }
    .stat-label { font-size:0.85em; color:#666; margin-top:2px; }
    
    .action-buttons {
      display:flex; gap:10px; padding:0 20px 20px; justify-content:center;
    }
    .action-btn {
      background:var(--primary); color:#fff; border:none; padding:10px 20px;
      border-radius:25px; cursor:pointer; font-weight:600; font-size:0.9em;
      transition:all 0.2s; flex:1; max-width:120px;
    }
    .action-btn:hover { background:var(--primary-dark); transform:translateY(-1px); }
    .action-btn.wdr { background:var(--accent); }
    .action-btn.wdr:hover { background:#00a891; }
    
    .input-field {
      width:100%; padding:12px; border:2px solid #e5e5e5; border-radius:8px;
      font-size:1em; margin-bottom:15px; transition:border-color 0.2s;
    }
    .input-field:focus { outline:none; border-color:var(--primary); }
    
    .captcha-row {
      display:flex; align-items:center; gap:10px; margin-bottom:15px;
    }
    .captcha-display {
      background:linear-gradient(135deg,#e3f2fd,#bbdefb); color:var(--primary-dark);
      padding:8px 16px; border-radius:8px; font-family:monospace; font-weight:700;
      font-size:1.1em; letter-spacing:2px; user-select:none; border:2px solid var(--primary);
    }
    .refresh-captcha {
      background:var(--accent); color:#fff; border:none; padding:8px 12px;
      border-radius:6px; cursor:pointer; font-weight:700;
    }
    
    #mainContent { padding:10px; }
    .category-tabs {
      display:flex; overflow-x:auto; gap:8px; padding:10px 0;
      scrollbar-width:none; -ms-overflow-style:none;
    }
    .category-tabs::-webkit-scrollbar { display:none; }
    .category-tab {
      background:rgba(39,176,247,0.1); color:var(--primary); border:2px solid var(--primary);
      padding:8px 16px; border-radius:20px; cursor:pointer; font-weight:600;
      white-space:nowrap; transition:all 0.2s; font-size:0.85em;
    }
    .category-tab.active, .category-tab:hover {
      background:var(--primary); color:#fff;
    }
    
    .question-card {
      background:#fff; border-radius:var(--card-radius); padding:20px;
      margin:15px 0; box-shadow:var(--shadow); border-left:4px solid var(--primary);
    }
    .question-title { font-size:1.1em; font-weight:700; color:var(--primary-dark); margin-bottom:8px; }
    .question-category {
      background:var(--primary); color:#fff; padding:4px 12px;
      border-radius:15px; font-size:0.8em; display:inline-block; margin-bottom:10px;
    }
    .question-text { color:#555; line-height:1.5; margin-bottom:15px; }
    .question-timer {
      color:#ff6b35; font-weight:600; font-size:0.9em; margin-bottom:15px;
    }
    
    .bet-section {
      background:rgba(39,176,247,0.05); padding:20px; border-radius:15px;
      border:2px solid rgba(39,176,247,0.2); margin-top:15px;
    }
    
    .bet-choice-section {
      margin-bottom:20px;
    }
    
    .bet-choice-title {
      font-size:1em; font-weight:700; color:var(--primary-dark);
      margin-bottom:12px; text-align:center;
    }
    
    .bet-choices {
      display:flex; gap:10px; justify-content:center; margin-bottom:20px;
    }
    
    .bet-choice {
      flex:1; max-width:120px; padding:12px 16px; border:2px solid #e5e5e5;
      border-radius:12px; background:#fff; cursor:pointer; text-align:center;
      font-weight:600; transition:all 0.3s ease; position:relative;
    }
    
    .bet-choice:hover {
      border-color:var(--primary); transform:translateY(-2px);
      box-shadow:0 4px 15px rgba(39,176,247,0.2);
    }
    
    .bet-choice.selected {
      border-color:var(--primary); background:var(--primary); color:#fff;
      transform:translateY(-2px); box-shadow:0 4px 15px rgba(39,176,247,0.3);
    }
    
    .bet-choice.yes { border-color:#4caf50; }
    .bet-choice.yes:hover, .bet-choice.yes.selected { 
      border-color:#4caf50; background:#4caf50; 
    }
    
    .bet-choice.no { border-color:#f44336; }
    .bet-choice.no:hover, .bet-choice.no.selected { 
      border-color:#f44336; background:#f44336; 
    }
    
    .bet-amount-section {
      margin-top:15px;
    }
    
    .bet-amount-title {
      font-size:0.95em; font-weight:600; color:var(--primary-dark);
      margin-bottom:10px; text-align:center;
    }
    
    .bet-amounts {
      display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));
      gap:8px; margin-bottom:15px;
    }
    
    .bet-amount {
      padding:10px 12px; border:2px solid #e5e5e5; border-radius:10px;
      background:#fff; cursor:pointer; text-align:center; font-weight:600;
      font-size:0.85em; transition:all 0.3s ease; position:relative;
    }
    
    .bet-amount:hover {
      border-color:var(--primary); transform:translateY(-1px);
      box-shadow:0 2px 8px rgba(39,176,247,0.2);
    }
    
    .bet-amount.selected {
      border-color:var(--primary); background:var(--primary); color:#fff;
      transform:translateY(-1px); box-shadow:0 2px 8px rgba(39,176,247,0.3);
    }
    
    .bet-amount .amount { font-size:0.9em; font-weight:700; }
    .bet-amount .win { font-size:0.75em; color:#4caf50; margin-top:2px; }
    .bet-amount.selected .win { color:#90EE90; }
    
    .place-bet-btn {
      width:100%; background:var(--primary); color:#fff; border:none;
      padding:15px; border-radius:12px; font-size:1em; font-weight:700;
      cursor:pointer; transition:all 0.3s ease; margin-top:15px;
    }
    
    .place-bet-btn:hover {
      background:var(--primary-dark); transform:translateY(-2px);
      box-shadow:0 4px 15px rgba(39,176,247,0.3);
    }
    
    .place-bet-btn:disabled {
      background:#ccc; cursor:not-allowed; transform:none;
      box-shadow:none;
    }
    
    .bet-info {
      background:#e8f5e8; color:#2e7d32; padding:15px; border-radius:12px;
      font-weight:600; border-left:4px solid #4caf50; text-align:center;
    }
    
    .result-chip {
      padding:8px 16px; border-radius:25px; font-weight:700; font-size:0.9em;
      display:inline-block; margin-top:10px;
    }
    .win-bg { background:#d4edda; color:#155724; }
    .lose-bg { background:#f8d7da; color:#721c24; }
    .pending-bg { background:#fff3cd; color:#856404; }
    
    .history-section { margin-top:20px; }
    .history-item {
      background:#fff; padding:15px; margin:10px 0; border-radius:12px;
      box-shadow:0 2px 10px rgba(0,0,0,0.08); border-left:4px solid var(--accent);
    }
    .history-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
    .history-question { font-weight:600; color:var(--primary-dark); }
    .history-amount { font-weight:700; }
    .history-details { font-size:0.9em; color:#666; }
    
    .auth-container {
      max-width:380px; margin:60px auto; padding:20px;
    }
    .auth-card {
      background:#fff; padding:30px; border-radius:var(--card-radius);
      box-shadow:var(--shadow); text-align:center;
    }
    .auth-title {
      font-size:1.5em; font-weight:700; color:var(--primary-dark);
      margin-bottom:25px;
    }
    .auth-input {
      width:100%; padding:12px; border:2px solid #e5e5e5; border-radius:8px;
      font-size:1em; margin-bottom:15px; box-sizing:border-box;
    }
    .auth-input:focus { outline:none; border-color:var(--primary); }
    .auth-btn {
      width:100%; background:var(--primary); color:#fff; border:none;
      padding:12px; border-radius:8px; font-size:1em; font-weight:700;
      cursor:pointer; margin-bottom:10px; transition:background 0.2s;
    }
    .auth-btn:hover { background:var(--primary-dark); }
    .auth-link { margin-top:15px; font-size:0.9em; }
    .auth-link a { color:var(--primary); text-decoration:none; font-weight:600; }
    
    .empty-state {
      text-align:center; padding:40px 20px; color:#666;
    }
    .empty-icon { font-size:3em; margin-bottom:15px; opacity:0.5; }
    
    @media (max-width: 500px) {
      #app-container { max-width:100%; border-radius:0; }
      .stats-grid { margin:5px; padding:15px; }
      .action-buttons { padding:0 15px 15px; }
      .question-card { margin:10px 5px; padding:15px; }
      .bet-choices { flex-direction:column; align-items:center; }
      .bet-choice { max-width:200px; }
      .bet-amounts { grid-template-columns:repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <div id="newsBar">
    <marquee id="newsText">Welcome to Cricket Quiz Bet! Place your bets and win big!</marquee>
  </div>

  <div id="authContainer" class="auth-container" style="display:none;"></div>

  <div id="app-container" style="display:none;">
    <div id="topbar">
      <div id="logo">üèè Cricket Quiz Bet</div>
      <div class="right">
        <button id="profileBtn" onclick="openProfile()">Profile</button>
        <button id="signOutBtn" onclick="signOut()">Sign Out</button>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-value" id="walletAmount">‚Çπ0</div>
        <div class="stat-label">Wallet</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="totalBets">0</div>
        <div class="stat-label">Total Bets</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="totalWins">0</div>
        <div class="stat-label">Wins</div>
      </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
      <div class="modal-content">
        <button class="close-btn" onclick="closeProfile()">√ó</button>
        <h3>üë§ Profile</h3>
        <div id="profileContent">Loading...</div>
      </div>
    </div>

    <div class="action-buttons">
      <button class="action-btn" onclick="openDeposit()">Deposit</button>
      <button class="action-btn wdr" onclick="openWithdraw()">Withdraw</button>
    </div>

    <!-- Deposit Modal -->
    <div id="depositModal" class="modal">
      <div class="modal-content">
        <button class="close-btn" onclick="closeDeposit()">√ó</button>
        <h3>üí∞ Deposit Money</h3>
        <p style="color:#666;font-size:0.9em;margin-bottom:15px;">
          Send money to UPI: <strong>your-upi@paytm</strong><br>
          Then fill this form with transaction details
        </p>
        <input type="number" id="depositAmount" class="input-field" placeholder="Amount (min ‚Çπ100)" min="100">
        <input type="text" id="depositName" class="input-field" placeholder="Your Full Name" required>
        <input type="tel" id="depositPhone" class="input-field" placeholder="Phone Number" maxlength="10">
        <input type="text" id="depositTxnId" class="input-field" placeholder="UPI Transaction ID">
        <div class="captcha-row">
          <div class="captcha-display" id="depositCaptcha">LOADING</div>
          <button class="refresh-captcha" onclick="refreshDepositCaptcha()" type="button">‚Üª</button>
          <input type="text" id="depositCaptchaInput" class="input-field" placeholder="Enter Captcha" style="margin-bottom:0;flex:1;">
        </div>
        <button class="action-btn" style="width:98%;margin-top:10px;" onclick="submitDeposit()">Submit</button>
      </div>
    </div>

    <!-- Withdraw Modal -->
    <div id="withdrawModal" class="modal">
      <div class="modal-content">
        <button class="close-btn" onclick="closeWithdraw()">√ó</button>
        <h3>üí∏ Withdraw Money</h3>
        <input type="number" id="withdrawAmount" class="input-field" placeholder="Amount (min ‚Çπ100)" min="100">
        <input type="text" id="withdrawAccount" class="input-field" placeholder="Bank Account Number" required>
        <input type="text" id="withdrawIFSC" class="input-field" placeholder="IFSC Code" required>
        <div class="captcha-row">
          <div class="captcha-display" id="withdrawCaptcha">LOADING</div>
          <button class="refresh-captcha" onclick="refreshWithdrawCaptcha()" type="button">‚Üª</button>
          <input type="text" id="withdrawCaptchaInput" class="input-field" placeholder="Enter Captcha" style="margin-bottom:0;flex:1;">
        </div>
        <button class="action-btn wdr" style="width:98%;margin-top:10px;" onclick="submitWithdraw()">Request Withdraw</button>
      </div>
    </div>

    <div id="mainContent">
      <div class="category-tabs" id="categoryTabs">
        <div class="category-tab active" onclick="filterByCategory('All')">All</div>
        <div class="category-tab" onclick="filterByCategory('IPL')">IPL</div>
        <div class="category-tab" onclick="filterByCategory('ODI')">ODI</div>
        <div class="category-tab" onclick="filterByCategory('T20')">T20</div>
        <div class="category-tab" onclick="filterByCategory('Test')">Test</div>
      </div>
      
      <div id="questionsContainer">
        <div class="empty-state">
          <div class="empty-icon">üîÑ</div>
          <div>Loading cricket betting opportunities...</div>
        </div>
      </div>
      
      <div class="history-section">
        <h3 style="padding:0 10px;color:var(--primary-dark);">üìä Recent Bets</h3>
        <div id="historyContainer">
          <div class="empty-state">
            <div class="empty-icon">üìã</div>
            <div>No betting history yet</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDV8nNFUsRWZvwE5hSC0fQAEjtLKPtIDPo",
      authDomain: "pdf-hosting-54a2f.firebaseapp.com",
      databaseURL: "https://pdf-hosting-54a2f-default-rtdb.firebaseio.com",
      projectId: "pdf-hosting-54a2f",
      storageBucket: "pdf-hosting-54a2f.appspot.com",
      messagingSenderId: "276398225231",
      appId: "1:276398225231:web:65b9ac0f9db22ed56976b7"
    };
    firebase.initializeApp(firebaseConfig);

    // **UPDATED BETTING PAYOUTS WITH NEW AMOUNTS**
    const BET_PAYOUTS = {
      20: 10,
      40: 20, 
      60: 30,
      100: 70,
      150: 100,    // NEW: ‚Çπ150 to win ‚Çπ100
      250: 150,    // NEW: ‚Çπ250 to win ‚Çπ150
      500: 250,    // NEW: ‚Çπ500 to win ‚Çπ250
      1000: 400    // NEW: ‚Çπ1000 to win ‚Çπ400
    };
    
    const CATEGORY_LIST = ["All","IPL","ODI","T20","Test"];
    let curUser = null, curSafeEmail = '', uStats={}, allQuestions={}, shownCategory='All', liveMatches={};

    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        curUser = user;
        curSafeEmail = user.email.replace(/[.#$[\]]/g, '_');
        document.getElementById('authContainer').style.display = 'none';
        document.getElementById('app-container').style.display = 'block';
        loadUserStats();
        loadQuestions();
        loadNews();
      } else {
        document.getElementById('authContainer').style.display = 'block';
        document.getElementById('app-container').style.display = 'none';
        renderAuthPage('login');
      }
    });

    function renderAuthPage(page) {
      let content = '';
      if (page === 'login') {
        content = `
          <div class="auth-card">
            <h2 class="auth-title">üèè Login to Cricket Bet</h2>
            <input type="email" id="loginEmail" class="auth-input" placeholder="Email">
            <input type="password" id="loginPassword" class="auth-input" placeholder="Password">
            <button class="auth-btn" onclick="doLogin()">Login</button>
            <div class="auth-link"><a href="#" onclick="renderAuthPage('signup')">Create Account</a></div>
            <div class="auth-link"><a href="#" onclick="renderAuthPage('forgot')">Forgot Password?</a></div>
          </div>
        `;
      } else if (page === 'signup') {
        content = `
          <div class="auth-card">
            <h2 class="auth-title">üìù Create Account</h2>
            <input type="email" id="signupEmail" class="auth-input" placeholder="Email">
            <input type="password" id="signupPassword" class="auth-input" placeholder="Password">
            <input type="password" id="confirmPassword" class="auth-input" placeholder="Confirm Password">
            <button class="auth-btn" onclick="doSignup()">Create Account</button>
            <div class="auth-link"><a href="#" onclick="renderAuthPage('login')">Already have account?</a></div>
          </div>
        `;
      } else if (page === 'forgot') {
        content = `
          <div class="auth-card">
            <h2 class="auth-title">üîê Reset Password</h2>
            <input type="email" id="resetEmail" class="auth-input" placeholder="Enter your email">
            <button class="auth-btn" onclick="doPasswordReset()">Send Reset Email</button>
            <div class="auth-link"><a href="#" onclick="renderAuthPage('login')">Back to Login</a></div>
          </div>
        `;
      }
      document.getElementById('authContainer').innerHTML = content;
    }

    function doLogin() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      if (!email || !password) return alert('Please fill all fields');
      
      firebase.auth().signInWithEmailAndPassword(email, password)
        .catch(error => alert('Login failed: ' + error.message));
    }

    function doSignup() {
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      if (!email || !password) return alert('Please fill all fields');
      if (password !== confirmPassword) return alert('Passwords do not match');
      if (password.length < 6) return alert('Password must be at least 6 characters');
      
      firebase.auth().createUserWithEmailAndPassword(email, password)
        .then(() => {
          const safeEmail = email.replace(/[.#$[\]]/g, '_');
          firebase.database().ref('users/' + safeEmail).set({
            email: email,
            totalScore: 100,
            joinedAt: Date.now()
          });
        })
        .catch(error => alert('Signup failed: ' + error.message));
    }

    function doPasswordReset() {
      const email = document.getElementById('resetEmail').value;
      if (!email) return alert('Please enter your email');
      
      firebase.auth().sendPasswordResetEmail(email)
        .then(() => {
          alert('Password reset email sent! Check your inbox.');
          renderAuthPage('login');
        })
        .catch(error => alert('Error: ' + error.message));
    }

    function signOut() {
      if (confirm('Are you sure you want to sign out?')) {
        firebase.auth().signOut();
      }
    }

    function loadUserStats() {
      firebase.database().ref('users/' + curSafeEmail).on('value', snap => {
        uStats = snap.val() || {totalScore: 100};
        document.getElementById('walletAmount').textContent = '‚Çπ' + (uStats.totalScore || 0);
        updateUserStats();
      });
    }

    function updateUserStats() {
      firebase.database().ref('userBets/' + curSafeEmail).once('value', snap => {
        const bets = snap.val() || {};
        const betArray = Object.values(bets);
        document.getElementById('totalBets').textContent = betArray.length;
        document.getElementById('totalWins').textContent = betArray.filter(bet => bet.finalPayout > 0).length;
      });
    }

    function loadNews() {
      firebase.database().ref('news').once('value', snap => {
        let t = snap.val() || "Welcome to Cricket Quiz Bet! Place your bets and win big!";
        document.getElementById('newsText').innerHTML = t;
      });
    }

    function loadQuestions() {
      firebase.database().ref('quizQuestions').on('value', snap => {
        allQuestions = snap.val() || {};
        displayQuestions();
      });
    }

    function displayQuestions() {
      const container = document.getElementById('questionsContainer');
      const questions = Object.entries(allQuestions);
      
      let filteredQuestions = questions.filter(([id, q]) => {
        if (shownCategory !== 'All' && q.category !== shownCategory) return false;
        return q.status === 'open' && new Date(q.endTime) > new Date();
      });
      
      if (filteredQuestions.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üèè</div>
            <div>No active bets in ${shownCategory} category</div>
          </div>
        `;
        return;
      }
      
      Promise.all(filteredQuestions.map(([qid, question]) => renderQuestionCard(qid, question)))
        .then(cards => {
          container.innerHTML = cards.join('');
        });
    }

    function renderQuestionCard(qid, question) {
      return new Promise(resolve => {
        firebase.database().ref('userBets/' + curSafeEmail + '/' + qid).once('value', betSnap => {
          const bet = betSnap.val();
          const locked = !!bet;
          const endTime = new Date(question.endTime);
          const timeLeft = Math.max(0, endTime - new Date());
          
          let resultHTML = '';
          if (question.status === 'closed' && bet) {
            if (bet.finalPayout && bet.finalPayout > 0) {
              resultHTML = `<span class="result-chip win-bg">WON ‚Çπ${bet.finalPayout}</span>`;
            } else if (bet.result === 'settled') {
              resultHTML = `<span class="result-chip lose-bg">LOST ‚Çπ${bet.amount}</span>`;
            }
          } else if (locked) {
            resultHTML = `<span class="result-chip pending-bg">BET PLACED</span>`;
          }
          
          let bettingHTML = '';
          if (!locked && timeLeft > 0) {
            bettingHTML = `
              <div class="bet-section">
                <div class="bet-choice-section">
                  <div class="bet-choice-title">üéØ Choose Your Answer</div>
                  <div class="bet-choices">
                    <div class="bet-choice yes" onclick="selectChoice('${qid}', 'Yes')">
                      <div style="font-size:1.2em;">‚úÖ</div>
                      <div>YES</div>
                    </div>
                    <div class="bet-choice no" onclick="selectChoice('${qid}', 'No')">
                      <div style="font-size:1.2em;">‚ùå</div>
                      <div>NO</div>
                    </div>
                  </div>
                </div>
                
                <div class="bet-amount-section">
                  <div class="bet-amount-title">üí∞ Select Bet Amount</div>
                  <div class="bet-amounts">
                    <div class="bet-amount" onclick="selectAmount('${qid}', 20)">
                      <div class="amount">‚Çπ20</div>
                      <div class="win">Win ‚Çπ10</div>
                    </div>
                    <div class="bet-amount" onclick="selectAmount('${qid}', 40)">
                      <div class="amount">‚Çπ40</div>
                      <div class="win">Win ‚Çπ20</div>
                    </div>
                    <div class="bet-amount" onclick="selectAmount('${qid}', 60)">
                      <div class="amount">‚Çπ60</div>
                      <div class="win">Win ‚Çπ30</div>
                    </div>
                    <div class="bet-amount" onclick="selectAmount('${qid}', 100)">
                      <div class="amount">‚Çπ100</div>
                      <div class="win">Win ‚Çπ70</div>
                    </div>
                    <div class="bet-amount" onclick="selectAmount('${qid}', 150)">
                      <div class="amount">‚Çπ150</div>
                      <div class="win">Win ‚Çπ100</div>
                    </div>
                    <div class="bet-amount" onclick="selectAmount('${qid}', 250)">
                      <div class="amount">‚Çπ250</div>
                      <div class="win">Win ‚Çπ150</div>
                    </div>
                    <div class="bet-amount" onclick="selectAmount('${qid}', 500)">
                      <div class="amount">‚Çπ500</div>
                      <div class="win">Win ‚Çπ250</div>
                    </div>
                    <div class="bet-amount" onclick="selectAmount('${qid}', 1000)">
                      <div class="amount">‚Çπ1000</div>
                      <div class="win">Win ‚Çπ400</div>
                    </div>
                  </div>
                  <button class="place-bet-btn" id="placeBetBtn_${qid}" onclick="placeBet('${qid}')" disabled>
                    üéØ Place Bet
                  </button>
                </div>
              </div>
            `;
          } else if (locked) {
            bettingHTML = `
              <div class="bet-info">
                Your Bet: <strong>${bet.betOption}</strong> for <strong>‚Çπ${bet.amount}</strong>
              </div>
            `;
          }
          
          const card = `
            <div class="question-card">
              <div class="question-category">${question.category}</div>
              <div class="question-title">${question.title}</div>
              <div class="question-text">${question.description || question.title}</div>
              <div class="question-timer">‚è∞ ${formatTimeLeft(timeLeft)}</div>
              ${resultHTML}
              ${bettingHTML}
            </div>
          `;
          
          resolve(card);
        });
      });
    }

    // Global variables to track selections
    let selectedChoices = {};
    let selectedAmounts = {};

    function selectChoice(qid, choice) {
      selectedChoices[qid] = choice;
      
      // Update UI
      const card = document.querySelector(`[onclick="selectChoice('${qid}', 'Yes')"]`).closest('.question-card');
      const choices = card.querySelectorAll('.bet-choice');
      choices.forEach(c => c.classList.remove('selected'));
      
      const selectedChoice = card.querySelector(`[onclick="selectChoice('${qid}', '${choice}')"]`);
      selectedChoice.classList.add('selected');
      
      updatePlaceBetButton(qid);
    }

    function selectAmount(qid, amount) {
      selectedAmounts[qid] = amount;
      
      // Update UI
      const card = document.querySelector(`[onclick="selectAmount('${qid}', ${amount})"]`).closest('.question-card');
      const amounts = card.querySelectorAll('.bet-amount');
      amounts.forEach(a => a.classList.remove('selected'));
      
      const selectedAmount = card.querySelector(`[onclick="selectAmount('${qid}', ${amount})"]`);
      selectedAmount.classList.add('selected');
      
      updatePlaceBetButton(qid);
    }

    function updatePlaceBetButton(qid) {
      const btn = document.getElementById(`placeBetBtn_${qid}`);
      if (selectedChoices[qid] && selectedAmounts[qid]) {
        btn.disabled = false;
        btn.textContent = `üéØ Bet ‚Çπ${selectedAmounts[qid]} on ${selectedChoices[qid]}`;
      } else {
        btn.disabled = true;
        btn.textContent = 'üéØ Place Bet';
      }
    }

    function placeBet(qid) {
      const choice = selectedChoices[qid];
      const amount = selectedAmounts[qid];
      
      if (!choice || !amount) {
        alert('Please select both an answer and bet amount');
        return;
      }
      
      firebase.database().ref('userBets/' + curSafeEmail + '/' + qid).once('value', snap => {
        if (snap.exists()) {
          alert('You have already placed a bet on this question!');
          return;
        }
        
        if (uStats.totalScore < amount) {
          alert(`Insufficient balance! You need ‚Çπ${amount} but have ‚Çπ${uStats.totalScore}. Please deposit more money.`);
          return;
        }
        
        const betData = {
          questionId: qid,
          amount: amount,
          betOption: choice,
          timestamp: Date.now(),
          result: 'pending'
        };
        
        firebase.database().ref('userBets/' + curSafeEmail + '/' + qid).set(betData).then(() => {
          uStats.totalScore -= amount;
          firebase.database().ref('users/' + curSafeEmail + '/totalScore').set(uStats.totalScore);
          alert(`üéØ Bet placed successfully! ‚Çπ${amount} deducted from your wallet.\nYour bet: ${choice} for ‚Çπ${amount}`);
          
          // Clear selections
          delete selectedChoices[qid];
          delete selectedAmounts[qid];
          
          displayQuestions();
          loadUserHistory();
        });
      });
    }

    function filterByCategory(category) {
      shownCategory = category;
      document.querySelectorAll('.category-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');
      displayQuestions();
    }

    function formatTimeLeft(timeLeft) {
      if (timeLeft <= 0) return 'Ended';
      const hours = Math.floor(timeLeft / (1000 * 60 * 60));
      const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
      return `${hours}h ${minutes}m left`;
    }

    function loadUserHistory() {
      firebase.database().ref('userBets/' + curSafeEmail).limitToLast(5).once('value', snap => {
        const bets = snap.val() || {};
        const container = document.getElementById('historyContainer');
        
        if (Object.keys(bets).length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">üìã</div>
              <div>No betting history yet</div>
            </div>
          `;
          return;
        }
        
        let html = '';
        Object.entries(bets).reverse().forEach(([qid, bet]) => {
          let resultText = 'Pending';
          let resultClass = 'pending-bg';
          
          if (bet.finalPayout && bet.finalPayout > 0) {
            resultText = `Won ‚Çπ${bet.finalPayout}`;
            resultClass = 'win-bg';
          } else if (bet.result === 'settled' && (!bet.finalPayout || bet.finalPayout === 0)) {
            resultText = `Lost ‚Çπ${bet.amount}`;
            resultClass = 'lose-bg';
          }
          
          html += `
            <div class="history-item">
              <div class="history-header">
                <div class="history-question">Bet: ${bet.betOption}</div>
                <div class="history-amount" style="color:${bet.result==='settled'&&bet.finalPayout>0?'#178b41':bet.result==='settled'?'#e44120':'#b28c19'}">${resultText}</div>
              </div>
              <div class="history-details">
                Amount: ‚Çπ${bet.amount} ‚Ä¢ ${new Date(bet.timestamp).toLocaleDateString()}
              </div>
            </div>
          `;
        });
        
        container.innerHTML = html;
      });
    }

    // Modal Functions
    function openProfile() {
      document.getElementById('profileModal').style.display = 'flex';
      document.getElementById('profileContent').innerHTML = `
        <p><strong>Email:</strong> ${curUser.email}</p>
        <p><strong>Wallet:</strong> ‚Çπ${uStats.totalScore || 0}</p>
        <p><strong>Joined:</strong> ${new Date(uStats.joinedAt || Date.now()).toLocaleDateString()}</p>
      `;
    }

    function closeProfile() {
      document.getElementById('profileModal').style.display = 'none';
    }

    // Deposit Functions
    let depositCaptchaCode = '';
    
    function refreshDepositCaptcha() {
      depositCaptchaCode = Math.random().toString(36).substr(2, 5).toUpperCase();
      document.getElementById('depositCaptcha').textContent = depositCaptchaCode;
    }

    function openDeposit() {
      if (!curUser) {
        alert('Please login first to deposit money');
        return;
      }
      
      document.getElementById('depositModal').style.display = 'flex';
      refreshDepositCaptcha();
    }

    function closeDeposit() {
      document.getElementById('depositModal').style.display = 'none';
      document.querySelectorAll('#depositModal .input-field').forEach(input => input.value = '');
    }

    function submitDeposit() {
      const amount = parseInt(document.getElementById('depositAmount').value);
      const name = document.getElementById('depositName').value.trim();
      const phone = document.getElementById('depositPhone').value.trim();
      const txnId = document.getElementById('depositTxnId').value.trim();
      const captcha = document.getElementById('depositCaptchaInput').value.trim();
      
      if (!amount || amount < 100) return alert('Minimum deposit amount is ‚Çπ100');
      if (!name) return alert('Please enter your full name');
      if (!phone || phone.length !== 10) return alert('Please enter valid 10-digit phone number');
      if (captcha.toUpperCase() !== depositCaptchaCode) return alert('Invalid captcha');
      
      const depositData = {
        email: curUser.email,
        amount: amount,
        name: name,
        phone: phone,
        txnId: txnId,
        timestamp: Date.now(),
        status: 'pending'
      };
      
      firebase.database().ref('depositRequests').push(depositData).then(() => {
        alert('‚úÖ Deposit request submitted! Admin will verify and add money to your wallet within 24 hours.');
        closeDeposit();
      }).catch(error => {
        alert('Error: ' + error.message);
      });
    }

    // Withdraw Functions
    let withdrawCaptchaCode = '';
    
    function refreshWithdrawCaptcha() {
      withdrawCaptchaCode = Math.random().toString(36).substr(2, 5).toUpperCase();
      document.getElementById('withdrawCaptcha').textContent = withdrawCaptchaCode;
    }

    function openWithdraw() {
      document.getElementById('withdrawModal').style.display = 'flex';
      refreshWithdrawCaptcha();
    }

    function closeWithdraw() {
      document.getElementById('withdrawModal').style.display = 'none';
      document.querySelectorAll('#withdrawModal .input-field').forEach(input => input.value = '');
    }

    function submitWithdraw() {
      const amount = parseInt(document.getElementById('withdrawAmount').value);
      const account = document.getElementById('withdrawAccount').value.trim();
      const ifsc = document.getElementById('withdrawIFSC').value.trim();
      const captcha = document.getElementById('withdrawCaptchaInput').value.trim();
      
      if (!amount || amount < 100) return alert('Minimum withdrawal amount is ‚Çπ100');
      if (amount > uStats.totalScore) return alert('Insufficient balance');
      if (!account) return alert('Please enter bank account number');
      if (!ifsc) return alert('Please enter IFSC code');
      if (captcha.toUpperCase() !== withdrawCaptchaCode) return alert('Invalid captcha');
      
      const withdrawData = {
        email: curUser.email,
        amount: amount,
        account: account,
        ifsc: ifsc,
        timestamp: Date.now(),
        status: 'pending'
      };
      
      firebase.database().ref('withdrawRequests').push(withdrawData).then(() => {
        alert('‚úÖ Withdrawal request submitted! Processing may take 24-48 hours.');
        closeWithdraw();
      }).catch(error => {
        alert('Error: ' + error.message);
      });
    }

    // Close modals when clicking outside
    window.onclick = function(event) {
      if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
      }
    }

    // Initialize
    setTimeout(() => {
      loadUserHistory();
    }, 2000);
  </script>
</body>
</html>
